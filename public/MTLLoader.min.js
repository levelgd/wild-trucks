THREE.MTLLoader=function(t){this.manager=void 0!==t?t:THREE.DefaultLoadingManager},THREE.MTLLoader.prototype={constructor:THREE.MTLLoader,load:function(t,r,a,e){var i=this,s=new THREE.XHRLoader(this.manager);s.setCrossOrigin(this.crossOrigin),s.load(t,function(t){r(i.parse(t))},a,e)},setBaseUrl:function(t){this.baseUrl=t},setCrossOrigin:function(t){this.crossOrigin=t},setMaterialOptions:function(t){this.materialOptions=t},parse:function(t){for(var r=t.split("\n"),a={},e=/\s+/,i={},s=0;s<r.length;s++){var o=r[s];if(o=o.trim(),0!==o.length&&"#"!==o.charAt(0)){var n=o.indexOf(" "),h=n>=0?o.substring(0,n):o;h=h.toLowerCase();var p=n>=0?o.substring(n+1):"";if(p=p.trim(),"newmtl"===h)a={name:p},i[p]=a;else if(a)if("ka"===h||"kd"===h||"ks"===h){var l=p.split(e,3);a[h]=[parseFloat(l[0]),parseFloat(l[1]),parseFloat(l[2])]}else a[h]=p}}var c=new THREE.MTLLoader.MaterialCreator(this.baseUrl,this.materialOptions);return c.setCrossOrigin(this.crossOrigin),c.setManager(this.manager),c.setMaterials(i),c}},THREE.MTLLoader.MaterialCreator=function(t,r){this.baseUrl=t,this.options=r,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping},THREE.MTLLoader.MaterialCreator.prototype={constructor:THREE.MTLLoader.MaterialCreator,setCrossOrigin:function(t){this.crossOrigin=t},setManager:function(t){this.manager=t},setMaterials:function(t){this.materialsInfo=this.convert(t),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(t){if(!this.options)return t;var r={};for(var a in t){var e=t[a],i={};r[a]=i;for(var s in e){var o=!0,n=e[s],h=s.toLowerCase();switch(h){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(n=[n[0]/255,n[1]/255,n[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===n[0]&&0===n[1]&&0===n[1]&&(o=!1);break;case"d":this.options&&this.options.invertTransparency&&(n=1-n)}o&&(i[h]=n)}}return r},preload:function(){for(var t in this.materialsInfo)this.create(t)},getIndex:function(t){return this.nameLookup[t]},getAsArray:function(){var t=0;for(var r in this.materialsInfo)this.materialsArray[t]=this.create(r),this.nameLookup[r]=t,t++;return this.materialsArray},create:function(t){return void 0===this.materials[t]&&this.createMaterial_(t),this.materials[t]},createMaterial_:function(t){var r=this.materialsInfo[t],a={name:t,side:this.side};for(var e in r){var i=r[e];switch(e.toLowerCase()){case"kd":a.diffuse=(new THREE.Color).fromArray(i);break;case"ka":break;case"ks":a.specular=(new THREE.Color).fromArray(i);break;case"map_kd":a.map=this.loadTexture(this.baseUrl+i),a.map.wrapS=this.wrap,a.map.wrapT=this.wrap;break;case"ns":a.shininess=i;break;case"d":1>i&&(a.transparent=!0,a.opacity=i);break;case"map_bump":case"bump":if(a.bumpMap)break;a.bumpMap=this.loadTexture(this.baseUrl+i),a.bumpMap.wrapS=this.wrap,a.bumpMap.wrapT=this.wrap}}return a.diffuse&&(a.color=a.diffuse),this.materials[t]=new THREE.MeshLambertMaterial(a),this.materials[t]},loadTexture:function(t,r,a,e,i){var s,o=THREE.Loader.Handlers.get(t),n=void 0!==this.manager?this.manager:THREE.DefaultLoadingManager;return null!==o?s=o.load(t,a):(s=new THREE.Texture,o=new THREE.ImageLoader(n),o.setCrossOrigin(this.crossOrigin),o.load(t,function(t){s.image=THREE.MTLLoader.ensurePowerOfTwo_(t),s.needsUpdate=!0,a&&a(s)},e,i)),void 0!==r&&(s.mapping=r),s}},THREE.MTLLoader.ensurePowerOfTwo_=function(t){if(!THREE.Math.isPowerOfTwo(t.width)||!THREE.Math.isPowerOfTwo(t.height)){var r=document.createElement("canvas");r.width=THREE.MTLLoader.nextHighestPowerOfTwo_(t.width),r.height=THREE.MTLLoader.nextHighestPowerOfTwo_(t.height);var a=r.getContext("2d");return a.drawImage(t,0,0,t.width,t.height,0,0,r.width,r.height),r}return t},THREE.MTLLoader.nextHighestPowerOfTwo_=function(t){--t;for(var r=1;32>r;r<<=1)t|=t>>r;return t+1},THREE.EventDispatcher.prototype.apply(THREE.MTLLoader.prototype);